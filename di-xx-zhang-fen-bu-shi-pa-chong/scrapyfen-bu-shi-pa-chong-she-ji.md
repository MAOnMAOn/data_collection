## scrapy 分布式设计

要想拥有一个健壮的爬虫，首先要进行爬虫的设计，这也就是入门常说的'工欲善其事必先利其器'。本节我们开始分布式爬虫设计的介绍，下面让我们一起感受一下吧。

### 1. scrapy 单主机爬虫
在进行分布式爬虫的设计之前单主机架构之中，Requests 队列由每台主机分别维护，而调度器从队列中调度 Request 进行请求，在 scrapy 框架的基础上，我们可以很快设计出一个相对健壮的爬虫：

![](/assets/单主机爬虫2.png)

但是上述设计，在面对大规模数据爬取，进行分布式部署时就多少有些力不从心了，在多主机进程之间相互独立分割的情况下，很容易发生重复请求与爬取的情况，既加大了目标站点的负载，又会给后期工作增加过多的损耗。所以在分布式爬虫之中，就需要进行必要的改良，比如使用消息队列机制。

### 2. Master-Slave初步设计
编写分布式爬虫，首先要做到队列的统一调度，请求的统一去重，同时通过消息队列机制实现程序的断点续爬。

![](/assets/截图_2017-11-22_11-05-31.png)

使用 scrapy-redis 默认配置，我们可以简单地实现队列统一调度，请求统一去重，以及断点续爬。

![](/assets/fbuspacjiagou.png)

但简单地使用默认配置，还会有许多一些问题